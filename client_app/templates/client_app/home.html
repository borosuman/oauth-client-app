<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>OAuth Client Demo</title>
    <style>
        :root {
            font-family: system-ui, sans-serif;
            line-height: 1.5;
        }
        body { margin: 2rem; }
        pre { background: #f4f4f4; padding: 1rem; border-radius: 4px; overflow-x: auto; }
        a.button {
            display: inline-block;
            padding: 0.65rem 1.2rem;
            border-radius: 4px;
            background: #2563eb;
            color: white;
            text-decoration: none;
        }
        a.button:hover { background: #1d4ed8; }
        header.site-header { margin-bottom: 1.5rem; }
        .actions {
            margin-top: 1rem;
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }
        .actions form { margin: 0; }
        .secondary-button {
            padding: 0.45rem 1rem;
            border-radius: 4px;
            border: 1px solid #d1d5db;
            background: white;
            cursor: pointer;
        }
        .secondary-button:hover { background: #f3f4f6; }
        .panel { margin-top: 0.75rem; }
        .hidden { display: none; }
        .toggle-link {
            display: inline-block;
            margin-top: 1rem;
            color: #2563eb;
        }
    </style>
</head>
<body>
    <header class="site-header">
        <h1>OAuth Client Demo</h1>
        <p>A client app developed using Django.</p>
    </header>

    <main>
        <section>
            <p>This page talks to the OAuth provider at <strong>{{ server_url }}</strong> requesting the
            <strong>{{ scope }}</strong> scope.</p>

            {% if not token %}
                <a class="button" href="{% url 'client_app:login' %}">Login via OAuth</a>
            {% else %}
                <div class="actions">
                    <span>You are authenticated.</span>
                    <form method="post" action="{% url 'client_app:logout' %}">
                        {% csrf_token %}
                        <button type="submit" class="secondary-button">Logout</button>
                    </form>
                </div>
            {% endif %}
        </section>

        {% if token %}
            <section>
                <a href="#" class="toggle-link" data-toggle-target="token-panel" data-show-text="Show token" data-hide-text="Hide token">Show token</a>
                <div id="token-panel" class="panel hidden">
                    <h2>Token</h2>
                    <pre>{{ token }}</pre>
                </div>
            </section>
        {% endif %}

        {% if api_response %}
            <section>
                <a href="#" class="toggle-link" data-toggle-target="profile-panel" data-show-text="Show profile" data-hide-text="Hide profile">Show profile</a>
                <div id="profile-panel" class="panel hidden">
                    <h2>/api/me/ response</h2>
                    <pre>{{ api_response }}</pre>
                </div>
            </section>
        {% endif %}
    </main>

    <script>
        (function () {
            const hiddenClass = 'hidden';
            document.querySelectorAll('.toggle-link').forEach((link) => {
                const targetId = link.dataset.toggleTarget;
                const showText = link.dataset.showText || 'Show';
                const hideText = link.dataset.hideText || 'Hide';
                const target = document.getElementById(targetId);
                if (!target) {
                    return;
                }
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    const isHidden = target.classList.toggle(hiddenClass);
                    link.textContent = isHidden ? showText : hideText;
                });
            });
        })();
    </script>
</body>
</html>
